#!/usr/bin/env bash

set -o nounset
set -o errexit
trap 'echo "Aborting due to errexit on line $LINENO. Exit code: $?" >&2' ERR
set -o errtrace
set -o pipefail
IFS=$'\n\t'

echo "ğŸš Setting up shell environment..."

# Change default shell to zsh (skip in CI environment)
if [[ ${CI:-"false"} != "true" ]]; then
  zsh_path=$(command -v zsh || true)
  if [[ -z "$zsh_path" ]]; then
    echo "âš ï¸  zsh not found; skipping default shell change"
  elif [[ "$SHELL" != "$zsh_path" ]]; then
    if grep -qx "$zsh_path" /etc/shells; then
      echo "Changing default shell to zsh..."
      chsh -s "$zsh_path"
      echo "âœ… Default shell changed to zsh"
      echo "ğŸ“Œ Please log out and log back in for the change to take effect"
    else
      echo "âš ï¸  $zsh_path is not in /etc/shells; skipping default shell change"
      echo "   Add it to /etc/shells and re-run if desired"
    fi
  else
    echo "âœ… Default shell is already zsh"
  fi
else
  echo "â­ï¸ Skipping shell change in CI environment"
fi

echo "ğŸ‰ Setup completed successfully!"
echo ""
echo "ğŸ“‹ Next steps:"
echo "1. Log out and log back in to activate zsh"
echo "2. Run 'tmux' and press 'Ctrl+s + I' to install tmux plugins"
echo "3. Open nvim to trigger LazyVim plugin installation"
echo "4. Add SSH keys to your Git services (displayed above)"
