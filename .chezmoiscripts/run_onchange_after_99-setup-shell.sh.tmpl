#!/usr/bin/env bash

set -o nounset
set -o errexit
trap 'echo "Aborting due to errexit on line $LINENO. Exit code: $?" >&2' ERR
set -o errtrace
set -o pipefail
IFS=$'\n\t'

echo "🐚 Setting up shell environment..."

# Change default shell to zsh (skip in CI environment)
if [[ ${CI:-"false"} != "true" ]]; then
  if [ "$SHELL" != "$(which zsh)" ]; then
    echo "Changing default shell to zsh..."
    chsh -s $(which zsh)
    echo "✅ Default shell changed to zsh"
    echo "📌 Please log out and log back in for the change to take effect"
  else
    echo "✅ Default shell is already zsh"
  fi
else
  echo "⏭️ Skipping shell change in CI environment"
fi

echo "🎉 Setup completed successfully!"
echo ""
echo "📋 Next steps:"
echo "1. Log out and log back in to activate zsh"
echo "2. Run 'tmux' and press 'Ctrl+s + I' to install tmux plugins"
echo "3. Open nvim to trigger LazyVim plugin installation"
echo "4. Add SSH keys to your Git services (displayed above)"